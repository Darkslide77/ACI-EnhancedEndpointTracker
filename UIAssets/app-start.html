<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="locale" content="US">
        <meta name="language" content="en">
        <meta name="country" content="US">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link type="text/css" rel="stylesheet" href="js/lib/select2/select2.min.css">
        <link type="text/css" rel="stylesheet" href="css/cui-1.3.3-official/css/cui-standard.min.css">
        <script type='text/javascript' src='js/lib/jquery-3.1.1.min.js'></script>
        <script type='text/javascript' src='js/lib/json2.js'></script>
        <script type='text/javascript' src='js/lib/js.cookie.js'></script>
        <script type='text/javascript' src='js/lib/knockout-3.4.2.js'></script>
        <script type='text/javascript' src='js/lib/moment.min.js'></script>
        <script type='text/javascript' src='js/lib/select2/select2.full.min.js'></script>
        <script type='text/javascript' src='js/common.js'></script>
    </head>
    <script type='text/javascript'>
        $().ready(function(){
            var _refresh_occurred = false;
            showInfoModal("waiting for app token")
            var app_token_success = function(){
                // prevent cascading events - only perform backend check on first success
                if(_refresh_occurred){ return ; }
                _refresh_occurred = true;
                _token_loaded = false;
                // single check without poll to see if app has started
                var started = function(){ window.location = "./app.html"; }
                var waiting = function(js, status_code, status_text){
                    //wait until app has actually started before forwarding to app.html
                    var msg="Waiting for token"
                    if(status_code!=500 && js!==undefined && "error" in js){msg=js["error"]} 
                    else if(status_code!=500){msg=status_text}
                    showInfoModal(msg)
                }
                pollAppStatus(started, waiting)
            }
            appTokenRefreshShim(app_token_success, function(err){
                showAlertModal("window error: "+err)
            });
        })
    </script>

    
    <body class="cui">
    
    <!-- single modal backdrop required -->
    <div class="modal-backdrop hide"></div>

    <!-- common alert modal -->
    <div class="modal modal-alert modal--small hide">
        <div class="modal__dialog">
            <div class="modal__content">
                <div class="modal__body">
                    <div class="alert alert--warning">
                        <div class="alert__icon icon-warning-outline"></div>
                        <div class="alert__message text-left">
                            <div class="half-margin-top">
                                <span class="text-large text-warning">Warning</span>
                                <p id="modal-alert-content"></p>
                            </div>
                            <div class="text-center base-margin-top">
                                <button class="btn btn--small btn--gray-ghost" onclick="hideModal()">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- common info modal -->
    <div class="modal modal-info modal--large hide">
        <div class="modal__dialog">
            <div class="modal__content">
                <div class="modal__body">
                    <div class='text-center'> 
                        <h4>Loading</h4>
                        <div class='text-small loading-dots loading-dots--info'>
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
                <div class="modal__footer">
                    <p class="text-left" id="modal-info-content"></p>
                </div>
            </div>
        </div>
    </div>


    </body>
</html>
